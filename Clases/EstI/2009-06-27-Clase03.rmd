---
layout: post
title: "Clase 03"
main-class: 'clase'
permalink: /EstadisticaI/EstI:title.html
tags:

introduction: Definición de las medidas más usadas en la práctica e introducción al análisis descriptivo gráfico y tabular.
header-includes:
   - \usepackage{amsmath,amssymb,amsthm,amsfonts}
   - \usepackage[sectionbib]{natbib}
   - \usepackage[hidelinks]{hyperref}
output:
  md_document:
    variant: markdown_strict+backtick_code_blocks+autolink_bare_uris+ascii_identifiers+tex_math_single_backslash
    preserve_yaml: TRUE
always_allow_html: yes   
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding,
  output_dir = "../../EstadisticaI/_posts/", output_format = "all"  ) })
bibliography: "../../referencias.bib"
csl: "../../apa.csl"
---

```{r knitr_init, echo=FALSE, cache=FALSE}
library(knitr)
## Global options
opts_chunk$set(echo=TRUE,
               cache=TRUE,
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=FALSE,
               fig.path = paste0("../../EstadisticaI/images/", "Clase03"),
               cache.path = "../../EstadisticaI/cache/",
               cache = FALSE)

```

## Resumen numéricos
Una parte importante de la estadística descriptiva, son las medidas estadísticas ya explicadas en la [Clase 01](../../EstadisticaI/EstIClase01.html){:target="_blank"} y [Clase 02](../../EstadisticaI/EstIClase02.html){:target="_blank"}, y aún más importante, es buscar la más adecuada para presentar dichas medidas.

Una alternativa es mediante resumenes númericos, los cual permiten observar el comportamiento de un conjunto de observaciones mediante diferentes medidas númericas, que se presentan de forma simple y ordenada.

Existen diferentes funciones que permiten realizar resumenes númericos en <tt>R</tt>, entre ellas se destaca la función `numSummary()` de la librería `RcmdrMisc` y la función `describe()` de la librería `psych`, que permiten realizar resumenes de variables tipo numéricas. 

Para ilustrar el manejo de estas funciones, se empleara la base de datos `CO2`, integrada en la librería `datasets`, la cual contiene la información sobre un experimento que mire la tolerancia al frío de la especie de hierba Echinochloa crus-galli.

```{r}
data() # Muestra todas las bases da datos integradas en los diferentes paquetes de R
data(CO2) # Carga la base de datos CO2
head(CO2) # Muestra el encabezado de la base de datos
str(CO2) # Muestra la estructura de la base de datos

# install.packages("RcmdrMisc") # Instala librería RcmdrMisc
library(RcmdrMisc) # Carga librería RcmdrMisc

# Forma básica numSummary 
numSummary(CO2$uptake) 
# Forma avanzada numSummary
numSummary(CO2$uptake, statistics = c("mean", "sd", "se", "IQR", "quantiles", "cv", "skewness", "kurtosis"), type = "3", quantiles = c(0, .25, .5, .75, 1)) 

library(psych) # Carga librería pysch
# Forma básica pysch
describe(CO2$uptake)
# Forma avanzada pysch
describe(CO2$uptake, na.rm = TRUE, interp = FALSE, skew = TRUE, ranges = TRUE, trim = 0.2,
         type = 3, quant = c(0.25, 0.75), IQR = TRUE)
```

También es posible realizar resumenes numérico por grupos, en donde, para la función `numSummary` es cuestión de agregar el argumento `groups`, mientras que la función `describe`, debe ser reemplazada por la función `describeBy` y agregar en ésta el argumento `group`. Es de anotar, que para realizar el resumen por grupos, la variable que se usará para realizar el agrupamiento debe ser de tipo **factor**

```{r}
str(CO2$Treatment)
# Forma avanzada numSummary por grupos
numSummary(data = CO2$uptake, groups = CO2$Treatment, statistics = c("mean", "sd", "se", "IQR", "quantiles", "cv", "skewness", "kurtosis"), type = "3", quantiles = c(0, .25, .5, .75, 1)) 

# Forma avanzada pysch por grupos
describeBy(x = CO2$uptake, group = CO2$Treatment, na.rm = TRUE, interp = FALSE, skew = TRUE, ranges = TRUE, trim = 0.2, type = 3, quant = c(0.25, 0.75), IQR = TRUE)
```

## Resumen tabular
Una alternativa para presentar resumenes de variables, cuando éstas no son númericas es mediante la construcción de tablas de frecuencias, las cuales permiten presentar de forma individual algunas de las características que poseen las variables, o permiten presentar de forma conjunta algunas de las características que comparten dichas variables.

Para presentar de forma individual o grupal las características de las variables, puede empleadase la función `table()` de la librería `base`, la cual agrega la información presentada en de las variables de una forma simple, que permite observar el número (frecuencia absoluta) de observaciones que comparten cierto atributo. Se aconseja que los datos usados dentro de la función `table()` sean de tipo *factor*.

Para ilustrar el manejo de esta funciones, se empleara la base de datos `KosteckiDillon`, integrada en la librería `carData`, la cual contiene un subconjunto de datos sobre tratamientos de migraña.

```{r}
data(KosteckiDillon) # Carga la base de datos KosteckiDillon
head(KosteckiDillon) # Muestra el encabezado de la base de datos
str(KosteckiDillon) # Muestra la estructura de la base de datos

#  Creación de tabla de frecuencias absolutas en una vía
## Si el conjunto de observaciones tiene valores faltantes agregar el comando useNA = "ifany"
tabla1via <- table(KosteckiDillon$medication) 
tabla1via

#  Creación de tabla de frecuencias absolutas en dos vía
tabla2vias <- table(KosteckiDillon$medication, KosteckiDillon$sex)
tabla2vias

# Agrega las sumas totales a la tabla de frecuencias absolutas por fila y/o columna
addmargins(tabla2vias, margin = c(1,2)) # margin = 1 en filas, margin = 2 en columnas
```

También es posible presentar los valores agregados, en forma de frecuencias relativas, mediante la función `prop.table(tabla)` de la librería `base` de <tt>R</tt>, donde `tabla` hace referencia a la tabla de frecuencias absolutas creada anteriormente.

```{r}
# Creación de tablas de frecuencias relativas en una vía
prop1via <- prop.table(tabla1via)
prop1via

#  Creación de tabla de frecuencias relativas en dos vía
prop2vias <- prop.table(tabla2vias)
prop2vias

# Agrega las sumas totales a la tabla de frecuencias relativas por fila y/o columna
addmargins(prop2vias, margin = c(1,2))
```

## Análisis gráfico
Otro aspecto importante del análisis descriptivo, es el que se realiza mediante análisis gráfico. El análisis gráfico es una forma de simplificar lo tedioso y complejo de un conjunto de observaciones, además de ser una forma más accesible de presentación de la información cuando se tienen muchas variables, puesto que permiten mostrar el comportamiento de los datos presentados, y hacer juicios respecto a su tendencia central, variabilidad, formas, patrones, tendencias, etc.

El análisis gráfico, puede ser dividido en diferentes clases

* Gráficos para una variable cuantitativa
* Gráficos para varias variables cuantitativas
* Gráficos para variables cualitativas
* Gráficos para variables cuantitativas y cualitativas

Para ilustrar el manejo de los diferentes gráficos, se empleara la base de datos `Insurance`, integrada en la librería `MASS`, la cual contiene la información sobre el número de asegurados que estuvieron expuestos a un riesgo determinado y el número de reclamaciones de seguros de automóviles realizadas por dichos asegurados. También se empleara la base de datos `KosteckiDillon`, integrada en la librería `carData`, la cual contiene un subconjunto de datos sobre tratamientos de migraña.


```{r}
library(MASS) # Carga librería MASS para poder cargar la base de datos
data(Insurance) # Carga la base de datos Insurance
head(Insurance) # Muestra el encabezado de la base de datos
str(Insurance) # Muestra la estructura de la base de datos
```


### Gráficos para una variable cuantitativa
Entre las gráficos básicos que permiten realizar análisis cuantitativo para una variable se tiene, al diagráma de tallo y hojas, gráfico de caja y bigotes, histograma y densidad.

#### Diagrama de tallo y hojas
Este gráfico sirve como medida de resumen de los datos, brinda información de valores máximos, mínimos, área en donde más se centran los datos, dispersión. datos atípicos y asimetría. A pesar de toda la información que puede brindar esta gráfica, su uso es muy limitado, ya que en situaciones en las cuales el rango de la variable es muy grande, ésta no permite visualidad con claridad dichos comportamientos. Este gráfico puede ser realizado mediante la función `stem()` de la librería `graphics` de <tt>R</tt>.

```{r}
stem(Insurance$Claims)
stem(Insurance$Claims, scale = 2)
```

#### Gráfico de caja y bigotes (boxplot)
Este gráfico sirve para presentar de forma visual, datos númericos a través de sus cuartiles, además de presentar otras  características importantes, tales como la dispersión, simetría y datos potencialmente atípicos.

La caja del gráfico contiene el 50% central de los datos (rango intercuartil), brinda información sobre la asimetría, `$Q_1$`, `$Q_2$` (mediana) y `$Q_3$`, el bigote inferor se calcula usualmente como `$Q_1–0.5*IQR$`,`$Q_1–IQR$`, o `$Q_1–1.5*IQR$` y el superior como `$Q3+0.5*IQR$`, `$Q3+IQR$` o `$Q3+1.5*IQR$`. Además, los valores que se encuentren por encima o debajo de los bigotes se consideran como potencialmente atípicos. Este gráfico puede ser realizado mediante la función `boxplot()` de la librería `graphics` de <tt>R</tt>.

```{r}
boxplot(Insurance$Claims, horizontal = T, xlab = "Conteo", main = "Número de reclamaciones", col = "lightblue")
```

También puede agregarse el argumento `notch = TRUE`, lo cual hace que se grafique una muesca en cada lado de la caja, alrededor de la mediana. @Mcgill1978 señala que las muescas muestran un intervalo del 95% de confianza alrededor de la mediana, y que son construidas a partir de la ecuación
`\begin{align*}
\tilde{X}\pm C*s
\end{align*}`

siendo `$s$`, una aproximación asintótica gausiana de la desviación estándar de la mediana, la cual está dada por
`\begin{align*}
s=\frac{1.25*IQR}{1.35*\sqrt{n}}
\end{align*}`

y siendo `$C=1.7$` una constante, la cual es una selección empírica realizada por los autores.

```{r}
boxplot(Insurance$Claims, horizontal = T, xlab = "Conteo", main = "Número de reclamaciones", col = "lightgreen", notch = T)
```

#### Histograma
Este gráfico muestra la distribución de frecuencia o densidades del grupo de observaciones, brinda información sobre el valor más probables, la dispersión, la asimetría y valores extremos. Adicionalmente, tiene la ventaja de que su interpretación es muy intuitiva y por tanto es de los gráficos más preferidos para resumir información.  Este gráfico puede ser realizado mediante la función `hist()` de la librería `graphics` de <tt>R</tt>.

```{r}
hist(Insurance$Claims, main = "Número de reclamaciones", xlab = "conteo", col = "lightblue", freq = T) # Para gráfico con valor de densidades escribir freq = FALSE
```

#### Densidad
Este gráfico funciona similar al histograma de densidades, con la diferencia de que en lugar de mostrar la distribución mediante clases (barras), éste muestra el comportamiendo de la distribución de las observaciones mediante una curva. Dicha curva, brinda mayor información que el histograma respecto al valor promedio, dispersión y asimetría. Este gráfico puede ser realizado mediante las funciones `plot(density())`, siendo `plot()` una función de la librería `graphics` y `density()` una función de la librería `stats`. Adicionalmente se presenta la función `polygon` de la librería `graphics`, la cual sirve para generar formas, o en este caso, darle color a la densidad 

```{r}
plot(density(Insurance$Claims), main = "Número de reclamaciones", xlab = "conteo", lwd = 2) # gráfica la densidad
polygon(density(Insurance$Claims), col = "lightblue") # Colorea la densidad
```

### Gráficos para varias variables cuantitativa
Entre las gráficos básicos que permiten realizar análisis cuantitativo para varias variables se tiene, el gráfico de dispersión cuando se tienen solo dos variables y la matriz de dispersión cuando se tienen más de dos variables.

#### Gráfico de dispersión
Este gráfico se emplea para hacer cruces entre dos variables cuantitativas, y sirve para ver tendencias y relaciones entre dos variables cuantitativas, además de permitir apreciar donde se centra el total de observaciones dados dos atributos cuantitativos. Este gráfico puede ser realizado mediante la función `plot()` de la librería `graphics` de <tt>R</tt>.
```{r}
plot(x = Insurance$Holders, y = Insurance$Claims, xlab = "Número de asegurados",
     ylab = "Número de reclamaciones", main = "Seguros :D", pch = 19)
```

#### Matríz de dispersión
Cuando se poseen más de dos variables cuantitativas, es posible presentar un matriz que muestre el cruce entre pares de variables, mediante cuadros con versiones simples de la función `$plot()$`. Este gráfico puede ser realizado mediante la función `pairs()` de la librería `graphics` de <tt>R</tt>.

```{r}
### Se crea nueva variable para observar el comportamiento de la función pairs
set.seed(1532) # Crea una semilla que permite replicar la simulación de valores de rnorm
utilidad <- 140 * Insurance$Holders - 500 * Insurance$Claims * rgamma(n = 64, shape = 54, rate = 26)

### Se crea matriz de variables a gráficar
mvari <- cbind(Insurance$Holders, Insurance$Claims, utilidad)
pairs(mvari, labels = c("Número de asegurados", "Número de reclamaciones", "Utilidad"))

```

Funciones complementarias pueden ser desarrolladas para mejorar la visualización los pares de variables. En el libro de @Hernandez2018[, pp. 40-49], se presentan diferentes funciones que pueden ser implementadas. Entre ellas

```{r}
# Función para dibujar la dispersión y agregar la recta de regresión
panel.reg <- function (x, y)
{
  points(x, y, pch=20)
  abline(lm(y ~ x), lwd=2, col='dodgerblue2')
}
# Función para crear el histograma
panel.hist <- function(x, ...)
{
  usr <- par("usr"); on.exit(par(usr))
  par(usr = c(usr[1:2], 0, 1.5) )
  h <- hist(x, plot = FALSE)
  breaks <- h$breaks; nB <- length(breaks)
  y <- h$counts; y <- y/max(y)
  rect(breaks[-nB], 0, breaks[-1], y, col="dodgerblue2", ...)
}
# Función para obtener la correlación
panel.cor <- function(x, y, digits=2, prefix="", cex.cor)
{
  usr <- par("usr"); on.exit(par(usr))
  par(usr = c(0, 1, 0, 1))
  r <- abs(cor(x, y))
  txt <- format(c(r, 0.123456789), digits=digits)[1]
  txt <- paste(prefix, txt, sep="")
  if(missing(cex.cor)) cex <- 0.8/strwidth(txt)
  text(0.5, 0.5, txt, cex = cex * r)
}

pairs(mvari, labels = c("Número de asegurados", "Número de reclamaciones", "Utilidad"),
      upper.panel = panel.reg,
      diag.panel = panel.hist,
      lower.panel = panel.cor)
```

### Gráficos para variables cualitativas
Entre las gráficos básicos que permiten realizar análisis cualitativo para variables se tiene, el gráfico de barras, gráfico pareto, gráfico de pastel, y gráfico de puntos.

#### Gráfico de barras
Sirve para resumir variables cualitativas mediante barras de frecuencias absolutas o relativas. Éste permite observar la concentración de observaciones en una o más categorias diferentes. Este gráfico puede ser realizado mediante la función `barplot()` de la librería `graphics` de <tt>R</tt>, usando como insumo, tablas de frecuencias absolutas o relativas.

```{r}
# Usando las tablas de frecuencias absolutas presentadas en el análisis tabular.
barplot(tabla1via, main = "Frecuencias absolutas de estado de medicación", col = rainbow(3)) 
barplot(prop1via, main = "Frecuencias relativas de estado de medicación", col = rainbow(20)[c(1,5,12)])
```

Este gráfico también puede ser empleado para realizar el cruce de dos o más variables cualitativas

```{r}
# Usando las tablas cruzadas de frecuencias absolutas presentadas en el análisis tabular.
barplot(tabla2vias, main = "Frecuencias absolutas de estado de medicación por sexo", col = c("lightblue", "lightgreen", "lightblue4")) 
barplot(prop2vias, main = "Frecuencias relativas de estado de medicación por sexo", col = c("lightblue", "lightgreen", "lightblue4"), beside = T)
legend("topright", c("none", "reduced", "continuing"), fill = c("lightblue", "lightgreen", "lightblue4")) 
```

#### Gráfico de pareto
Este gráfico es similar al grafico de barras para una sola variable cualitativa, pero con la ventaja de que presenta las frecuencias absolutas, relativas, y las frecuencias acumuladas absolutas y acumuladas relativas en el mismo gráfico. Este gráfico puede ser realizado mediante la función `pareto.chart()` de la librería `qqc`, usando como insumo, tablas de frecuencias absolutas o relativas.

```{r}
# install.packages("qcc") # Instrala paquete qcc
library(qcc) # Carga paquete qcc
# Usando las tablas de frecuencias absolutas presentadas en el análisis tabular.
pareto.chart(tabla1via, las = 1, main = "Gráfico Pareto para estado de medicación")
```

#### Gráfico de pastel
Este gráfico también sirve para representar gráficamente las tablas de frecuencias absolutas y relativas para una variable cualitativa. A pesar de ser un gráfico muy usado en la práctica, no muestra bien la información que se desea presentar, ya que siempre debe estar acompañado de los porcentajes o frecuencias dentro de cada área, ya que no hacerlo, dicho gráfico puede ser muy engañoso. Este gráfico puede ser realizado mediante la función `pie()` de la librería `graphics` de <tt>R</tt>, usando como insumo, tablas de frecuencias absolutas o relativas.

```{r}
# Usando las tablas de frecuencias relativas presentadas en el análisis tabular.
pie(prop1via, main = "Estado de medicación", col = rainbow(20)[c(4,13,16)])
legend("topright", c("18.9%", "23.63%", "57.47%"), fill = rainbow(20)[c(4,13,16)])
```

#### Gráfico de puntos
Este gráfico también es similar al grafico de barras, sirve para presentar la frecuencia de una variable cualitativa o un cruce de dos variables cualitativas, y muestra un punto que representa el conteo del total de observaciones que hay para cada variable. Este gráfico puede ser realizado mediante la función `dotchart()` de la librería `graphics` de <tt>R</tt>, usando como insumo, tablas de frecuencias absolutas o relativas.

```{r}
# Usando las tablas de frecuencias absolutas presentadas en el análisis tabular.
## Gráfico para una sola variable cualitativa
dotchart(tabla1via, main = "Frecuencias absolutas de estado de medicación")
## Gráfico para el cruce de dos variables cualitativas
dotchart(tabla2vias, main = "Frecuencias absolutas de estado de medicación por sexo")
```

### Gráficos para variables cuantitativas y cualitativas
Entre las gráficos básicos que permiten analizar los cruces entre variables cuantitativas y cualitativas se tiene, al gráfico de caja y bigotes, gráfico de medias, histogramas, densidades, diagrama de dispersión.

#### Gráfico de caja y bigotes
Este gráfico sirve para presentar de forma visual, datos númericos por categorías a través de sus cuartiles, además de presentar otras características importantes, tales como la dispersión, simetría y datos potencialmente atípicos. Este gráfico puede ser realizado mediante la función `boxplot()` de la librería `graphics` de <tt>R</tt>.

```{r}
boxplot(Insurance$Claims ~ Insurance$Group, horizontal = T, xlab = "Conteo", ylab = "Grupo", main = "Número de reclamaciones", col = rainbow(4), las = 1)
```

También puede agregarse el argumento `notch = TRUE`, lo cual hace que se grafique una muesca en cada lado de la caja, alrededor de la mediana. Además, si las muescas de dos parcelas no se superponen, entonces se tendrá evidencia sólida respecto a que la mediana de los grupos es diferente [@Chambers1983, p. 62].

```{r}
boxplot(Insurance$Claims ~ Insurance$Group, horizontal = T, xlab = "Conteo", ylab = "Grupo", main = "Número de reclamaciones", col = rainbow(4), las = 1, notch = T)
```

#### Gráfico de medias
Este gráfico sirve para presentar de forma visual, grupos de datos númericos a través de sus media y desviación estándar. El gráfico está compuesto por un punto que representa el valor el valor promedio del grupo de observaciones y las barras representan **una** desviación estándar de la media. Este gráfico puede ser realizado mediante la función `plotMeans` de la librería `RcmdrMisc`.

```{r eval=F}
library(RcmdrMisc) # Carga la librería RcmdrMisc
# recordar escribir en error.bars = "sd" porque por defecto se presenta el error estándar y no la desviacion estándar.
plotMeans(response = Insurance$Claims, , error.bars = "sd") 
```


#### Histograma
Este gráfico muestra la distribución de frecuencia o densidades de dos o más grupos de observaciones, brinda información sobre de los valores más probables, las dispersiones, las asimetrías y valores extremos. Este gráfico puede ser realizado mediante la función `hist()` de la librería `graphics` de <tt>R</tt>. Para agregar más histograma en la misma gráfico, es necesario agregar el argumento `add = TRUE`.

```{r}
# Supongamos otra compaía de seguros con su propia variable de reclamaciones
set.seed(6321) # Se establece semilla para replicar los resultados simulados
reclamaciones <- rexp(n = 64, rate = 1/74) # Se crea variable nueva

hist(Insurance$Claims, main = "Número de reclamaciones", xlab = "conteo", col = "lightblue", freq = T, breaks = 30) 
hist(reclamaciones, col = "lightblue4", freq = T, add = T, breaks = 30) 
```

dado que no es posible observar bien la diferencia entre variables con el histograma, cuando se emplea el paquete base, es posible usar librerías que permitan gráficos más avanzados, tales como los creados mediante la función `ggplot` de la librería `ggplot2`.

```{r}
# install.packages("ggplot2") # instala paquete ggplot2
library(ggplot2)
# Se organiza base de datos para poder ser leida
BD <- data.frame(Reclama = c(Insurance$Claims, reclamaciones), Clase = as.factor(rep(x = 1:2, each = 64)))

ggplot(BD, aes(x=Reclama, fill=Clase)) + geom_histogram(alpha=0.7,colour=1, position="identity") + theme_bw()+ylab("Frecuencia") + xlab("Conteo") + ggtitle("Número de reclamaciones")
```

Es de anotar que también puede cambiar la forma en que se agrupan los datos en cada una de las categorías, y por tanto, puede verse diferencias entre el gráfico realizado con el paquete base y el gráfico realizado con el paquete ggplot.

#### Densidad
Este gráfico muestra el comportamiendo de la distribución de las observaciones mediante una curva de densidad para cada una de las variables. Este gráfico, brinda información respecto al valor promedio, dispersión y asimetría. Este gráfico puede ser realizado mediante las funciones `plot(density())`, siendo `plot()` una función de la librería `graphics` y `density()` una función de la librería `stats`. Para realizar el segundo gráfico, se debe emplear la función `lines(density())`, siendo `lines()` una función de la librería `graphics`.

```{r}
plot(density(Insurance$Claims), main = "Número de reclamaciones", xlab = "conteo", lwd = 2) # gráfica la densidad
lines(density(reclamaciones), col = "red", lwd = 2)
legend("topright", legend = c("clase1", "clase2"), col = c("black", "red"), lwd = 2)
```

#### Gráfico de dispersión
Este gráfico se emplea para hacer cruces entre dos variables cuantitativas y diferenciarlas por una cualitativa. Este sirve para ver tendencias, diferencias entre clases, relaciones entre dos variables cuantitativas, y permite apreciar donde se centra el total de observaciones dados dos atributos cuantitativos. Este gráfico puede ser realizado mediante la función `plot()` de la librería `graphics` de <tt>R</tt>.

```{r}
plot(x = Insurance$Holders, y = Insurance$Claims, xlab = "Número de asegurados",
     ylab = "Número de reclamaciones", main = "Seguros por grupo :D", pch = 19, col = Insurance$Group)
legend("bottomright", legend = levels(Insurance$Group), col = 1:4, pch = 19)
```

## Referencias


